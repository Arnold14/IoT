
<div id="camModel" >
<div class="am-btn-group doc-js-btn-1" data-am-button>
  <label class="am-btn am-btn-primary">
    <input type="radio" name="options" value="left" id="option1"><i class="am-icon-chevron-left"></i>
  </label>
  <label class="am-btn am-btn-primary">
    <input type="radio" name="options" value="hold" id="option2"><i class="am-icon-stop"></i>
  </label>
  <label class="am-btn am-btn-primary">
    <input type="radio" name="options" value="right" id="option3"><i class="am-icon-chevron-right"></i>
  </label>
</div>
<div class="switch am-fr">
    <input class="cmn-toggle cmn-toggle-round" type="checkbox" id="cb-6" value="camara" data-bind="checked : Boolean($root.switch), event:{ change: $root.camChanged}" ></input>
    <label for = "cb-6"></label>
</div>
<iframe align="middle" width="640" height="480" id="videoframe" scrolling="no" border="0" name="lantk" frameBorder="0" allowfullscreen mozallowfullscreen webkitallowfullscreen src="widget.html"></iframe>
</div>
<script type="text/javascript">
var togswitch; var controller;
function camaraVM() 
{
    var self = this;
    // make the variables observable    
    self.switch = new Boolean();
    self.controller = ko.observable(0);

    self.loaddata = function () 
    {
        $.ajax({
            url: "/index.php/devices/7"
        }).done(function (data) 
        {
            var camValue = $.parseJSON(data.value);// = ko.observable();
            self.switch = Boolean( camValue.switch );
            self.controller(Number( camValue.controller ));

            controller  = self.controller;

        });
    };
    self.camChanged = function ()
    {
        if (self.switch) 
        {
            self.switch = 0;
            console.log("1 to ",self.switch);
            $("#msg").html("1 to "+self.switch);
                $('#my-prompt').modal('open');
        }else{
            self.switch = 1;
            console.log("0 to ",self.switch);
            $("#msg").html("0 to "+ self.switch);
                $('#my-prompt').modal('open');
        };

        var switchData = '{"type":"step","switch":' + Number(self.switch) +',"controller":'+Number(self.controller())+'}';
        $.ajax(
        {
            type: "POST",
            url: "/index.php/devices/6",
            data: switchData,
            success: function (subdata) 
            {
               $.post("/index.php/feedback/camara", "{\"code\":1}");
               setTimeout(function()
                {
                    $.get("/index.php/feedback/camara",
                        function(fdbData)
                        {
                            /*if(1 == fdbData)
                            {
                                console.log("Led2 switch Not accessable !!");
                            }else if (2 == fdbData) 
                            {
                                console.log("Something wrong with the server !!");
                            }else if (0 == fdbData) 
                            {
                                console.log("Led2 switch Success Changed !");
                            };*/
                        });
                }, 4000);

               if(self.switch)
                {
                    $topLoader.percentageLoader({progress: Number(self.controller())/100 });
                }
            },
            error: function (xhr, status, error) 
            {
                $.post("/index.php/feedback/camara",
                    "{'code':2}",
                    function()
                    {
                        console.log("seed 2 OK");
                    });
                $("#msg").html(xhr.responseText);
                $('#my-prompt').modal('open');
            }
        });
    }
}
// check out which radio is selected and run the function radioChange under event:change
$(function() 
{
    var $radios = $('[name="options"]');
    $radios.on('change',function() 
    {
        if(togswitch)
        {
           if ("left" == $radios.filter(':checked').val())
            {
                var controllerData = '{"type":"step","switch":' + Number(togswitch) +',"controller":1}';
                $.ajax(
                    {
                        type: "POST",
                        url: "/index.php/devices/6",
                        data: controllerData,
                        success : function (){console.log("post ", $radios.filter(':checked').val());}
                    });
            }
            else if ("right" == $radios.filter(':checked').val()) 
            {
                var controllerData = '{"type":"step","switch":' + Number(togswitch) +',"controller":2}';
                $.ajax(
                    {
                        type: "POST",
                        url: "/index.php/devices/6",
                        data: controllerData,
                        success : function (){console.log("post ", $radios.filter(':checked').val());}
                    });
            }else
            {
                var controllerData = '{"type":"step","switch":' + Number(togswitch) +',"controller":0}';
                $.ajax(
                    {
                        type: "POST",
                        url: "/index.php/devices/6",
                        data: controllerData,
                        success : function (){console.log("post ", $radios.filter(':checked').val());}
                    });
            }
        }
      console.log('selected : ', $radios.filter(':checked').val(),"con",controller());
    });

    var fullscreen = $.AMUI.fullscreen;
    $('[name="lantk"]').on('click', function () 
    {
        if (fullscreen.enabled) 
        {
            fullscreen.toggle(this);
            
        }
        console.log("fullscreen:", fullscreen.enabled);
    });


});
var ctvm2 = new camaraVM();

setTimeout('ctvm2.loaddata()', 300);
ko.applyBindings(ctvm2, document.getElementById("camModel"));

//go back to main page
var mainmodel = ko.dataFor(document.getElementById("mainModel"));
mainmodel.showback(true);
mainmodel.showuinfo(false);
mainmodel.gopage = function (url) 
{
    $("#render").load("web/center_page.html");
    mainmodel.showback(false);
    mainmodel.showuinfo(true);
};
    
</script>
